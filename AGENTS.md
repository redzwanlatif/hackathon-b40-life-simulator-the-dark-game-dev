# AGENTS.md - B40 Life Simulator
## Cursor x Anthropic Hackathon MY 2025

> **Mission:** Build a financial life simulator that makes a judge FEEL the B40 experience in 2 minutes.

---

## ğŸ“‹ Project Overview

### What We're Building
A 2D walking map game where players navigate a Malaysian neighborhood, make financial decisions, and experience consequences powered by Claude AI. The game teaches financial literacy through lived experience, not lectures.

### Core Experience
```
Player walks on map â†’ Visits location â†’ Claude generates scenario â†’ 
Player makes choice â†’ Credit score/money changes â†’ 
Past decisions create future consequences â†’ Emotional impact
```

### Team
- **Pro Dev:** Backend, Convex, Claude integration
- **Intermediate Dev:** Frontend, Map UI, Components
- **Noob:** Content, Testing, Pitch deck, Demo video

### Timeline
- **Duration:** 16 hours
- **Submission:** 6:00 AM
- **Checkpoints:** Hour 4, Hour 8 (critical), Hour 12, Hour 16

---

## ğŸ› ï¸ Tech Stack

### Core Framework
```
Next.js 14 (App Router)
â”œâ”€â”€ TypeScript (strict mode)
â”œâ”€â”€ React 18
â””â”€â”€ Server Components + Client Components
```

### Styling
```
Tailwind CSS
â”œâ”€â”€ shadcn/ui (component library)
â”œâ”€â”€ Lucide React (icons)
â””â”€â”€ Framer Motion (animations)
```

### Database & Backend
```
Convex
â”œâ”€â”€ Real-time database
â”œâ”€â”€ Server functions (queries, mutations, actions)
â”œâ”€â”€ Built-in TypeScript support
â””â”€â”€ No separate backend needed
```

### AI
```
Anthropic Claude API
â”œâ”€â”€ Model: claude-sonnet-4-20250514
â”œâ”€â”€ Used for: Scenario generation, NPC dialogue, consequences, endings
â””â”€â”€ Integration via Convex actions
```

### Deployment
```
Vercel
â”œâ”€â”€ Auto-deploy from GitHub
â”œâ”€â”€ Edge functions
â””â”€â”€ Preview deployments
```

### Package Manager
```
pnpm (preferred) or npm
```

---

## ğŸ“ Project Structure

```
b40-simulator/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx              # Root layout with providers
â”‚   â”œâ”€â”€ page.tsx                # Landing page
â”‚   â”œâ”€â”€ setup/
â”‚   â”‚   â””â”€â”€ page.tsx            # Persona selection
â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â””â”€â”€ page.tsx            # Main game screen
â”‚   â””â”€â”€ ending/
â”‚       â””â”€â”€ page.tsx            # Game over / results
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                     # shadcn components
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â”œâ”€â”€ GameMap.tsx         # Main map with locations
â”‚   â”‚   â”œâ”€â”€ PlayerAvatar.tsx    # Walking character
â”‚   â”‚   â”œâ”€â”€ Location.tsx        # Individual location button
â”‚   â”‚   â”œâ”€â”€ LocationDialog.tsx  # Interaction modal
â”‚   â”‚   â”œâ”€â”€ StatsBar.tsx        # Health/Stress/Money display
â”‚   â”‚   â”œâ”€â”€ CreditScore.tsx     # Credit score meter
â”‚   â”‚   â””â”€â”€ DaySummary.tsx      # End of day modal
â”‚   â””â”€â”€ providers/
â”‚       â””â”€â”€ ConvexProvider.tsx  # Convex client provider
â”‚
â”œâ”€â”€ convex/
â”‚   â”œâ”€â”€ _generated/             # Auto-generated by Convex
â”‚   â”œâ”€â”€ schema.ts               # Database schema
â”‚   â”œâ”€â”€ games.ts                # Game state mutations/queries
â”‚   â”œâ”€â”€ decisions.ts            # Decision tracking
â”‚   â”œâ”€â”€ ai.ts                   # Claude integration actions
â”‚   â””â”€â”€ creditScore.ts          # Credit calculation logic
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ prompts.ts              # Claude system prompts
â”‚   â”œâ”€â”€ constants.ts            # Game constants (locations, personas)
â”‚   â”œâ”€â”€ utils.ts                # Utility functions
â”‚   â””â”€â”€ types.ts                # TypeScript types
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ images/                 # Static assets (if any)
â”‚
â”œâ”€â”€ .env.local                  # Environment variables
â”œâ”€â”€ convex.json                 # Convex configuration
â”œâ”€â”€ tailwind.config.ts          # Tailwind configuration
â”œâ”€â”€ tsconfig.json               # TypeScript configuration
â””â”€â”€ package.json
```

---

## ğŸ—„ï¸ Database Schema (Convex)

```typescript
// convex/schema.ts
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  // Main game state
  games: defineTable({
    odoo: v.string(),                    // Session ID
    playerName: v.string(),
    persona: v.string(),                 // "fresh_grad" | "single_parent" | "factory_worker"
    
    // Time
    currentWeek: v.number(),             // 1-12
    currentDay: v.number(),              // 1-7
    actionsToday: v.number(),            // Max 3 per day
    
    // Money
    money: v.number(),                   // Cash on hand
    monthlyIncome: v.number(),           // Base salary
    savings: v.number(),                 // Bank savings
    savingsGoal: v.number(),             // Target (default 3000)
    
    // Debt
    debt: v.object({
      ptptn: v.number(),                 // Education loan
      creditCard: v.number(),            // CC debt
      bankLoan: v.number(),              // Personal loan
      ahLong: v.number(),                // Loan shark (dangerous!)
    }),
    
    // Credit
    creditScore: v.number(),             // 300-850
    
    // Bills (due weekly)
    bills: v.object({
      tnb: v.object({ 
        amount: v.number(), 
        dueDay: v.number(), 
        paid: v.boolean() 
      }),
      water: v.object({ 
        amount: v.number(), 
        dueDay: v.number(), 
        paid: v.boolean() 
      }),
      phone: v.object({ 
        amount: v.number(), 
        dueDay: v.number(), 
        paid: v.boolean() 
      }),
      rent: v.object({ 
        amount: v.number(), 
        dueDay: v.number(), 
        paid: v.boolean() 
      }),
    }),
    
    // Stats (0-100)
    health: v.number(),
    stress: v.number(),
    fatigue: v.number(),
    
    // Relationships (-100 to +100)
    relationships: v.object({
      family: v.number(),
      roommate: v.number(),
      pakAli: v.number(),                // Kedai owner
      boss: v.number(),
    }),
    
    // Work
    jobPerformance: v.number(),          // 0-100 KPI
    overtimeThisWeek: v.number(),        // Hours
    
    // Game status
    status: v.string(),                  // "active" | "completed" | "game_over"
    endingType: v.optional(v.string()),
    
    createdAt: v.number(),
  }).index("by_odoo", ["odoo"]),

  // Decision history (for Claude context)
  decisions: defineTable({
    gameId: v.id("games"),
    week: v.number(),
    day: v.number(),
    location: v.string(),
    
    // What happened
    scenarioTitle: v.string(),
    scenarioText: v.string(),
    choiceMade: v.string(),
    choiceText: v.string(),
    
    // Immediate effects
    moneyChange: v.number(),
    creditChange: v.number(),
    healthChange: v.number(),
    stressChange: v.number(),
    
    // Relationship changes
    relationshipChanges: v.optional(v.object({
      target: v.string(),
      change: v.number(),
    })),
    
    // Hidden consequence (triggers later)
    hiddenConsequence: v.optional(v.string()),
    consequenceTriggersWeek: v.optional(v.number()),
    consequenceTriggered: v.boolean(),
    
    // Metadata
    emotionalTone: v.string(),           // "hopeful" | "tense" | "desperate" | etc.
    npcInvolved: v.optional(v.string()),
    
    createdAt: v.number(),
  }).index("by_game", ["gameId"])
    .index("by_game_week", ["gameId", "week"]),

  // Credit history (for score calculation)
  creditEvents: defineTable({
    gameId: v.id("games"),
    week: v.number(),
    day: v.number(),
    eventType: v.string(),               // "bill_paid" | "bill_missed" | "loan_taken" | etc.
    description: v.string(),
    impact: v.number(),                  // Points change
    createdAt: v.number(),
  }).index("by_game", ["gameId"]),

  // Scheduled events (consequences, bills, salary)
  scheduledEvents: defineTable({
    gameId: v.id("games"),
    triggerWeek: v.number(),
    triggerDay: v.number(),
    eventType: v.string(),               // "consequence" | "bill_due" | "salary" | "random"
    data: v.any(),
    triggered: v.boolean(),
    createdAt: v.number(),
  }).index("by_game_trigger", ["gameId", "triggerWeek", "triggerDay"]),
});
```

---

## ğŸ® Game Constants

```typescript
// lib/constants.ts

export const LOCATIONS = [
  { 
    id: "home", 
    name: "Rumah", 
    icon: "Home", 
    x: 15, 
    y: 25, 
    color: "#3b82f6",
    description: "Rest, check status, pay bills online"
  },
  { 
    id: "shop", 
    name: "Kedai Pak Ali", 
    icon: "ShoppingCart", 
    x: 50, 
    y: 20, 
    color: "#22c55e",
    description: "Buy groceries, daily essentials"
  },
  { 
    id: "petrol", 
    name: "Petronas", 
    icon: "Fuel", 
    x: 85, 
    y: 25, 
    color: "#ef4444",
    description: "Fill petrol, buy snacks"
  },
  { 
    id: "tnb", 
    name: "TNB", 
    icon: "Zap", 
    x: 15, 
    y: 70, 
    color: "#eab308",
    description: "Pay electricity bill"
  },
  { 
    id: "office", 
    name: "Pejabat", 
    icon: "Building2", 
    x: 50, 
    y: 65, 
    color: "#8b5cf6",
    description: "Work, overtime opportunities"
  },
  { 
    id: "bank", 
    name: "Bank", 
    icon: "Landmark", 
    x: 85, 
    y: 70, 
    color: "#0ea5e9",
    description: "Savings, loans, check credit score"
  },
  { 
    id: "bus", 
    name: "Bas Stop", 
    icon: "Bus", 
    x: 50, 
    y: 90, 
    color: "#f97316",
    description: "Public transport, save on petrol"
  },
] as const;

export const PERSONAS = [
  {
    id: "fresh_grad",
    name: "Fresh Grad KL",
    description: "Baru habis degree, kerja pertama di KL",
    monthlyIncome: 2200,
    startingMoney: 800,
    startingSavings: 500,
    startingDebt: { ptptn: 30000, creditCard: 0, bankLoan: 0, ahLong: 0 },
    startingCredit: 650,
    bills: {
      tnb: { amount: 80, dueDay: 5, paid: false },
      water: { amount: 25, dueDay: 5, paid: false },
      phone: { amount: 60, dueDay: 3, paid: false },
      rent: { amount: 550, dueDay: 1, paid: false },
    },
  },
  {
    id: "single_parent",
    name: "Single Parent Penang",
    description: "Janda/Duda, 2 anak sekolah rendah",
    monthlyIncome: 1800,
    startingMoney: 400,
    startingSavings: 200,
    startingDebt: { ptptn: 0, creditCard: 2000, bankLoan: 5000, ahLong: 0 },
    startingCredit: 580,
    bills: {
      tnb: { amount: 120, dueDay: 5, paid: false },
      water: { amount: 35, dueDay: 5, paid: false },
      phone: { amount: 40, dueDay: 3, paid: false },
      rent: { amount: 450, dueDay: 1, paid: false },
    },
  },
  {
    id: "factory_worker",
    name: "Pekerja Kilang JB",
    description: "Kerja shift di kilang elektronik",
    monthlyIncome: 1600,
    startingMoney: 300,
    startingSavings: 100,
    startingDebt: { ptptn: 0, creditCard: 500, bankLoan: 0, ahLong: 0 },
    startingCredit: 620,
    bills: {
      tnb: { amount: 60, dueDay: 5, paid: false },
      water: { amount: 20, dueDay: 5, paid: false },
      phone: { amount: 35, dueDay: 3, paid: false },
      rent: { amount: 350, dueDay: 1, paid: false },
    },
  },
] as const;

export const CREDIT_SCORE_RANGES = {
  EXCELLENT: { min: 750, max: 850, label: "Excellent", color: "#22c55e" },
  GOOD: { min: 700, max: 749, label: "Good", color: "#84cc16" },
  FAIR: { min: 650, max: 699, label: "Fair", color: "#eab308" },
  POOR: { min: 550, max: 649, label: "Poor", color: "#f97316" },
  BAD: { min: 300, max: 549, label: "Bad", color: "#ef4444" },
} as const;

export const GAME_CONFIG = {
  MAX_WEEKS: 12,
  DAYS_PER_WEEK: 7,
  ACTIONS_PER_DAY: 3,
  SALARY_DAY: 1,                         // Day 1 of each week
  DEFAULT_SAVINGS_GOAL: 3000,
  AH_LONG_INTEREST_RATE: 0.20,           // 20% per week!
  CREDIT_CARD_INTEREST_RATE: 0.015,      // 1.5% per month
  BANK_LOAN_INTEREST_RATE: 0.08,         // 8% per year
} as const;
```

---

## ğŸ§  Claude Prompts

```typescript
// lib/prompts.ts

export const GAME_MASTER_SYSTEM_PROMPT = `
You are the Game Master for B40 Life Simulator, a narrative financial simulation game set in Malaysia.

YOUR IDENTITY:
- You are the narrator, all NPCs, and the living world
- You write immersive, emotional second-person narrative
- You naturally mix English with Manglish ("alamak", "potong stim", "lepak", "tapau")
- You remember EVERYTHING the player has done and reference it

PLAYER CONTEXT:
Name: {playerName}
Persona: {persona}
Week: {currentWeek}, Day: {currentDay}

CURRENT STATS:
Money: RM {money}
Savings: RM {savings} (Goal: RM {savingsGoal})
Credit Score: {creditScore}
Debt - PTPTN: RM {ptptnDebt}, Credit Card: RM {ccDebt}, Bank: RM {bankDebt}, Ah Long: RM {ahLongDebt}
Health: {health}%, Stress: {stress}%

RELATIONSHIPS:
Family: {familyRel}, Roommate: {roommateRel}, Pak Ali: {pakAliRel}, Boss: {bossRel}

DECISION HISTORY:
{decisionHistory}

ACTIVE CONSEQUENCES:
{activeConsequences}

YOUR TASK:
Generate a scenario for the player visiting: {location}

RULES:
1. Create realistic Malaysian B40 scenarios
2. Reference past decisions when relevant (this is CRITICAL for emotional impact)
3. Each choice must have clear trade-offs (money vs health, now vs later)
4. Include "hidden" consequences that trigger in future weeks
5. NPCs should have distinct personalities and remember past interactions
6. Be emotionally intelligent - notice player patterns (always cheap? always overwork?)
7. Don't be preachy - show consequences, don't lecture

NPC PERSONALITIES:
- Pak Ali (Kedai owner): Kind uncle energy, notices if you look tired/stressed, offers hutang to loyal customers
- Boss (Encik Razak): Fair but firm, under pressure himself, rewards reliability
- Roommate (Amir): Also struggling, sometimes borrows money, loyal friend
- Family (Mak): Loves unconditionally, worries about you, doesn't ask for money but you feel guilty

OUTPUT FORMAT (JSON):
{
  "narration": "2-3 paragraphs of immersive story. Use line breaks. Reference past if relevant.",
  "npcPresent": "pak_ali" | "boss" | "roommate" | "family" | null,
  "npcDialogue": "What the NPC says (if present). Use Manglish naturally.",
  "emotion": "hopeful" | "tense" | "desperate" | "neutral" | "warm" | "anxious",
  "choices": [
    {
      "id": "choice_1",
      "text": "What player sees as the option",
      "innerThought": "Player's internal reaction/fear/hope about this choice",
      "consequences": {
        "money": -50,
        "credit": 0,
        "health": -5,
        "stress": 10,
        "relationship": { "target": "pak_ali", "change": 5 }
      },
      "hiddenConsequence": "Description of what happens later (not shown to player)",
      "triggersInWeeks": 2
    }
  ],
  "billReminder": "If a bill is due soon, remind subtly in narration" | null,
  "foreshadowing": "Subtle hint for your own continuity tracking"
}
`;

export const CONSEQUENCE_PROMPT = `
You are tracking consequences for B40 Life Simulator.

A past decision is now triggering its consequence.

ORIGINAL DECISION (Week {originalWeek}):
{originalScenario}
Player chose: {originalChoice}
Hidden consequence: {hiddenConsequence}

CURRENT STATE:
Week: {currentWeek}, Day: {currentDay}
Money: RM {money}, Credit: {creditScore}
Relevant relationship: {relevantRelationship}

Generate how this consequence manifests NOW. Make it feel connected to the original choice.
The player should think "Oh no, this is because of what I did in Week {originalWeek}!"

OUTPUT FORMAT (JSON):
{
  "narration": "The consequence happening, referencing the original decision",
  "npcInvolved": "npc_id or null",
  "npcDialogue": "What they say, if involved",
  "immediateEffects": {
    "money": number,
    "credit": number,
    "health": number,
    "stress": number
  },
  "newChoices": [...] // If player can respond, same format as regular choices
}
`;

export const ENDING_PROMPT = `
Generate a personalized ending for this B40 Life Simulator playthrough.

FULL JOURNEY:
{fullDecisionHistory}

FINAL STATS:
Money: RM {money}
Savings: RM {savings} (Goal was: RM {savingsGoal})
Credit Score: {creditScore} (Started at: {startingCredit})
Total Debt: RM {totalDebt}
Health: {health}%, Stress: {stress}%
Relationships: {relationships}

KEY MOMENTS (high-impact decisions):
{keyMoments}

ENDING TYPES:
- "survivor": Made it through, but at what cost? (High savings, low relationships)
- "community": Broke but beloved, network saves you (Low savings, high relationships)
- "burnout": Promoted but empty, hospital scene (Overworked, ignored health)
- "trapped": Debt spiral, Ah Long ending (High Ah Long debt)
- "breakthrough": Found a way out, hope (Took risks that paid off)
- "loop": Same position, nothing changed (Played it "safe" every time)

Generate an ending that:
1. Reflects their JOURNEY, not just final numbers
2. References 2-3 specific decisions they made
3. Shows who they became
4. Provides ONE genuine financial insight
5. Ends with emotional resonance

OUTPUT FORMAT (JSON):
{
  "endingType": "one of the types above",
  "title": "Poetic title for their ending",
  "narration": "3-4 paragraphs telling their story, what happened after Week 12",
  "keyMomentCallbacks": ["Reference to decision 1", "Reference to decision 2"],
  "financialLesson": "One real insight about B40 life based on their playthrough",
  "finalLine": "Emotional closing line",
  "stats": {
    "finalCreditScore": number,
    "moneyManaged": "total money that flowed through their hands",
    "decisionsCount": number,
    "consequencesTriggered": number
  }
}
`;

export const LOCATION_SPECIFIC_PROMPTS: Record<string, string> = {
  home: "Player is at home. Can rest, pay bills online, call family, deal with roommate.",
  shop: "Player is at Kedai Pak Ali. Grocery shopping, price decisions, Pak Ali interactions.",
  petrol: "Player is at Petronas. Fuel decisions, snack temptations, transport costs.",
  tnb: "Player is at TNB office. Bill payment, potential late fees, bureaucracy.",
  office: "Player is at work. Boss interactions, OT opportunities, workplace drama.",
  bank: "Player is at the bank. Savings, loans, credit score check, Ah Long lurks outside.",
  bus: "Player is at bus stop. Transport decisions, time vs money, random encounters.",
};
```

---

## ğŸ¨ UI Components

### GameMap Component

```tsx
// components/game/GameMap.tsx
"use client";

import { motion } from "framer-motion";
import { useState } from "react";
import { 
  Home, ShoppingCart, Fuel, Zap, Building2, Landmark, Bus 
} from "lucide-react";
import { LOCATIONS } from "@/lib/constants";

const ICON_MAP = {
  Home, ShoppingCart, Fuel, Zap, Building2, Landmark, Bus
};

interface GameMapProps {
  onLocationArrive: (locationId: string) => void;
  currentLocation: string;
  disabled?: boolean;
}

export function GameMap({ onLocationArrive, currentLocation, disabled }: GameMapProps) {
  const [playerPos, setPlayerPos] = useState(() => {
    const home = LOCATIONS.find(l => l.id === "home")!;
    return { x: home.x, y: home.y };
  });
  const [isWalking, setIsWalking] = useState(false);

  const handleLocationClick = (location: typeof LOCATIONS[number]) => {
    if (isWalking || disabled) return;
    
    if (location.id === currentLocation) {
      onLocationArrive(location.id);
      return;
    }

    setIsWalking(true);
    setPlayerPos({ x: location.x, y: location.y });

    setTimeout(() => {
      setIsWalking(false);
      onLocationArrive(location.id);
    }, 800);
  };

  return (
    <div className="relative w-full aspect-[16/10] bg-gradient-to-b from-emerald-200 via-emerald-300 to-emerald-400 rounded-2xl overflow-hidden shadow-2xl border-4 border-emerald-600">
      
      {/* Decorative trees */}
      <div className="absolute top-[10%] left-[30%] text-4xl opacity-40">ğŸŒ³</div>
      <div className="absolute top-[45%] right-[10%] text-3xl opacity-40">ğŸŒ´</div>
      <div className="absolute bottom-[20%] left-[5%] text-3xl opacity-40">ğŸŒ³</div>

      {/* Roads */}
      <div className="absolute top-1/2 left-0 right-0 h-2 bg-amber-800/30 -translate-y-1/2" />
      <div className="absolute left-1/2 top-0 bottom-0 w-2 bg-amber-800/30 -translate-x-1/2" />

      {/* Location markers */}
      {LOCATIONS.map((loc) => {
        const IconComponent = ICON_MAP[loc.icon as keyof typeof ICON_MAP];
        
        return (
          <motion.button
            key={loc.id}
            className="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-1 group z-10"
            style={{ left: `${loc.x}%`, top: `${loc.y}%` }}
            onClick={() => handleLocationClick(loc)}
            disabled={isWalking || disabled}
            whileHover={{ scale: 1.1 }}
            whileTap={{ scale: 0.95 }}
          >
            <motion.div
              className="w-14 h-14 rounded-xl flex items-center justify-center shadow-lg"
              style={{ backgroundColor: loc.color }}
              animate={{
                y: currentLocation === loc.id ? [0, -4, 0] : 0,
              }}
              transition={{
                duration: 1,
                repeat: currentLocation === loc.id ? Infinity : 0,
              }}
            >
              <IconComponent className="w-7 h-7 text-white" />
            </motion.div>
            <span className="text-xs font-bold text-emerald-900 bg-white/80 px-2 py-0.5 rounded-full">
              {loc.name}
            </span>
          </motion.button>
        );
      })}

      {/* Player character */}
      <motion.div
        className="absolute transform -translate-x-1/2 -translate-y-1/2 z-20"
        animate={{
          left: `${playerPos.x}%`,
          top: `${playerPos.y + 10}%`,
        }}
        transition={{
          type: "spring",
          stiffness: 100,
          damping: 15,
        }}
      >
        <div className="absolute w-8 h-2 bg-black/30 rounded-full blur-sm -bottom-1 left-1/2 -translate-x-1/2" />
        <motion.div
          className="text-4xl"
          animate={{
            y: isWalking ? [0, -8, 0] : 0,
            rotate: isWalking ? [-5, 5, -5] : 0,
          }}
          transition={{
            duration: 0.25,
            repeat: isWalking ? Infinity : 0,
          }}
        >
          ğŸš¶
        </motion.div>
      </motion.div>

      {/* Walking indicator */}
      {isWalking && (
        <motion.div 
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white text-sm px-4 py-2 rounded-full"
        >
          Berjalan...
        </motion.div>
      )}
    </div>
  );
}
```

### LocationDialog Component

```tsx
// components/game/LocationDialog.tsx
"use client";

import { motion, AnimatePresence } from "framer-motion";
import { X } from "lucide-react";
import { Button } from "@/components/ui/button";

interface Choice {
  id: string;
  text: string;
  innerThought?: string;
  consequences: {
    money?: number;
    credit?: number;
    health?: number;
    stress?: number;
  };
}

interface LocationDialogProps {
  isOpen: boolean;
  onClose: () => void;
  locationName: string;
  narration: string;
  npcDialogue?: string;
  choices: Choice[];
  onChoice: (choice: Choice) => void;
  playerMoney: number;
  isLoading?: boolean;
}

export function LocationDialog({
  isOpen,
  onClose,
  locationName,
  narration,
  npcDialogue,
  choices,
  onChoice,
  playerMoney,
  isLoading,
}: LocationDialogProps) {
  return (
    <AnimatePresence>
      {isOpen && (
        <>
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40"
            onClick={onClose}
          />

          <motion.div
            initial={{ opacity: 0, y: 50 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 50 }}
            className="fixed inset-x-4 top-[5%] bottom-[5%] md:inset-auto md:top-[10%] md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-lg md:max-h-[80vh] bg-zinc-900 rounded-2xl shadow-2xl z-50 overflow-hidden flex flex-col"
          >
            {/* Header */}
            <div className="flex items-center justify-between p-4 border-b border-zinc-800 shrink-0">
              <h2 className="text-lg font-bold text-white">{locationName}</h2>
              <button onClick={onClose} className="text-zinc-400 hover:text-white">
                <X className="w-5 h-5" />
              </button>
            </div>

            {/* Content */}
            <div className="p-4 overflow-y-auto flex-1">
              {isLoading ? (
                <div className="flex items-center justify-center py-12">
                  <motion.div
                    className="w-8 h-8 border-2 border-amber-500 border-t-transparent rounded-full"
                    animate={{ rotate: 360 }}
                    transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                  />
                </div>
              ) : (
                <>
                  <p className="text-zinc-300 leading-relaxed whitespace-pre-line mb-4">
                    {narration}
                  </p>

                  {npcDialogue && (
                    <blockquote className="border-l-4 border-amber-500 pl-4 py-2 mb-4 bg-amber-500/10 rounded-r-lg">
                      <p className="text-amber-200 italic">"{npcDialogue}"</p>
                    </blockquote>
                  )}

                  <div className="text-sm text-zinc-500 mb-4">
                    Baki: <span className="text-emerald-400 font-bold">RM {playerMoney}</span>
                  </div>

                  <div className="space-y-2">
                    {choices.map((choice, i) => {
                      const cost = Math.abs(choice.consequences.money || 0);
                      const canAfford = !choice.consequences.money || 
                                        choice.consequences.money >= 0 || 
                                        cost <= playerMoney;
                      
                      return (
                        <motion.div
                          key={choice.id}
                          initial={{ opacity: 0, x: -20 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ delay: i * 0.1 }}
                        >
                          <Button
                            variant="outline"
                            className={`w-full h-auto p-4 text-left flex flex-col items-start gap-1 
                              ${canAfford 
                                ? "bg-zinc-800 hover:bg-zinc-700 hover:border-amber-500 border-zinc-700" 
                                : "bg-zinc-900 opacity-50 cursor-not-allowed border-zinc-800"
                              }`}
                            onClick={() => canAfford && onChoice(choice)}
                            disabled={!canAfford}
                          >
                            <div className="flex justify-between w-full">
                              <span className="text-white">{choice.text}</span>
                              {choice.consequences.money && (
                                <span className={choice.consequences.money < 0 ? "text-red-400" : "text-green-400"}>
                                  {choice.consequences.money < 0 ? "-" : "+"}RM {Math.abs(choice.consequences.money)}
                                </span>
                              )}
                            </div>
                            {choice.innerThought && (
                              <span className="text-xs text-zinc-500 italic">{choice.innerThought}</span>
                            )}
                          </Button>
                        </motion.div>
                      );
                    })}
                  </div>
                </>
              )}
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  );
}
```

### CreditScore Component

```tsx
// components/game/CreditScore.tsx
"use client";

import { motion } from "framer-motion";
import { CREDIT_SCORE_RANGES } from "@/lib/constants";

interface CreditScoreProps {
  score: number;
  previousScore?: number;
}

export function CreditScore({ score, previousScore }: CreditScoreProps) {
  const getScoreInfo = (s: number) => {
    if (s >= 750) return CREDIT_SCORE_RANGES.EXCELLENT;
    if (s >= 700) return CREDIT_SCORE_RANGES.GOOD;
    if (s >= 650) return CREDIT_SCORE_RANGES.FAIR;
    if (s >= 550) return CREDIT_SCORE_RANGES.POOR;
    return CREDIT_SCORE_RANGES.BAD;
  };

  const info = getScoreInfo(score);
  const percentage = ((score - 300) / 550) * 100;
  const changed = previousScore && previousScore !== score;
  const increased = previousScore && score > previousScore;

  return (
    <div className="bg-zinc-900 rounded-xl p-4">
      <div className="flex items-center justify-between mb-2">
        <span className="text-xs text-zinc-500">Credit Score</span>
        {changed && (
          <motion.span
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            className={`text-xs ${increased ? "text-green-400" : "text-red-400"}`}
          >
            {increased ? "â†‘" : "â†“"} {Math.abs(score - previousScore!)}
          </motion.span>
        )}
      </div>
      
      <div className="flex items-end gap-2">
        <motion.span 
          className="text-2xl font-bold"
          style={{ color: info.color }}
          key={score}
          initial={{ scale: 1.2 }}
          animate={{ scale: 1 }}
        >
          {score}
        </motion.span>
        <span className="text-xs text-zinc-500 mb-1">/ 850</span>
      </div>

      <div className="mt-2 h-2 bg-zinc-800 rounded-full overflow-hidden">
        <motion.div
          className="h-full rounded-full"
          style={{ backgroundColor: info.color }}
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ duration: 0.5 }}
        />
      </div>

      <span className="text-xs mt-1 block" style={{ color: info.color }}>
        {info.label}
      </span>
    </div>
  );
}
```

---

## ğŸ”Œ Convex Functions

### Game Mutations

```typescript
// convex/games.ts
import { mutation, query } from "./_generated/server";
import { v } from "convex/values";
import { PERSONAS, GAME_CONFIG } from "../lib/constants";

export const createGame = mutation({
  args: {
    playerName: v.string(),
    personaId: v.string(),
  },
  handler: async (ctx, args) => {
    const odoo = crypto.randomUUID();
    const persona = PERSONAS.find(p => p.id === args.personaId);
    
    if (!persona) throw new Error("Invalid persona");

    const gameId = await ctx.db.insert("games", {
      odoo,
      playerName: args.playerName,
      persona: args.personaId,
      currentWeek: 1,
      currentDay: 1,
      actionsToday: 0,
      money: persona.startingMoney,
      monthlyIncome: persona.monthlyIncome,
      savings: persona.startingSavings,
      savingsGoal: GAME_CONFIG.DEFAULT_SAVINGS_GOAL,
      debt: persona.startingDebt,
      creditScore: persona.startingCredit,
      bills: persona.bills,
      health: 80,
      stress: 30,
      fatigue: 20,
      relationships: {
        family: 50,
        roommate: 50,
        pakAli: 0,
        boss: 50,
      },
      jobPerformance: 70,
      overtimeThisWeek: 0,
      status: "active",
      createdAt: Date.now(),
    });

    return { gameId, odoo };
  },
});

export const getCurrentGame = query({
  args: { odoo: v.string() },
  handler: async (ctx, args) => {
    return await ctx.db
      .query("games")
      .withIndex("by_odoo", q => q.eq("odoo", args.odoo))
      .first();
  },
});

export const updateGameState = mutation({
  args: {
    gameId: v.id("games"),
    updates: v.any(),
  },
  handler: async (ctx, args) => {
    await ctx.db.patch(args.gameId, args.updates);
  },
});

export const advanceTime = mutation({
  args: { gameId: v.id("games") },
  handler: async (ctx, args) => {
    const game = await ctx.db.get(args.gameId);
    if (!game) throw new Error("Game not found");

    let { currentDay, currentWeek, actionsToday } = game;
    
    actionsToday++;
    
    // If 3 actions done, advance to next day
    if (actionsToday >= GAME_CONFIG.ACTIONS_PER_DAY) {
      actionsToday = 0;
      currentDay++;
      
      // If week done, advance to next week
      if (currentDay > GAME_CONFIG.DAYS_PER_WEEK) {
        currentDay = 1;
        currentWeek++;
        
        // Apply weekly interest on debts
        const newDebt = { ...game.debt };
        if (newDebt.ahLong > 0) {
          newDebt.ahLong = Math.round(newDebt.ahLong * (1 + GAME_CONFIG.AH_LONG_INTEREST_RATE));
        }
        if (newDebt.creditCard > 0) {
          newDebt.creditCard = Math.round(newDebt.creditCard * (1 + GAME_CONFIG.CREDIT_CARD_INTEREST_RATE));
        }
        
        // Reset bills for new week
        const newBills = { ...game.bills };
        Object.keys(newBills).forEach(key => {
          newBills[key as keyof typeof newBills].paid = false;
        });
        
        // Check if game over
        if (currentWeek > GAME_CONFIG.MAX_WEEKS) {
          await ctx.db.patch(args.gameId, { status: "completed" });
          return { completed: true };
        }
        
        await ctx.db.patch(args.gameId, {
          currentWeek,
          currentDay,
          actionsToday,
          debt: newDebt,
          bills: newBills,
        });
        
        return { newWeek: true, currentWeek };
      }
    }
    
    await ctx.db.patch(args.gameId, { currentDay, actionsToday });
    return { currentDay, actionsToday };
  },
});
```

### AI Actions

```typescript
// convex/ai.ts
"use node";
import { action } from "./_generated/server";
import { v } from "convex/values";
import Anthropic from "@anthropic-ai/sdk";
import { api } from "./_generated/api";
import { GAME_MASTER_SYSTEM_PROMPT, LOCATION_SPECIFIC_PROMPTS } from "../lib/prompts";

const anthropic = new Anthropic();

export const generateScenario = action({
  args: {
    gameId: v.id("games"),
    locationId: v.string(),
  },
  handler: async (ctx, args) => {
    // Fetch game state
    const game = await ctx.runQuery(api.games.getById, { gameId: args.gameId });
    if (!game) throw new Error("Game not found");

    // Fetch decision history
    const decisions = await ctx.runQuery(api.decisions.getByGame, { 
      gameId: args.gameId 
    });

    // Fetch pending consequences
    const consequences = await ctx.runQuery(api.decisions.getPendingConsequences, {
      gameId: args.gameId,
      week: game.currentWeek,
      day: game.currentDay,
    });

    // Build context
    const decisionHistory = decisions
      .slice(-10)
      .map(d => `Week ${d.week}, Day ${d.day} at ${d.location}: ${d.choiceText}`)
      .join("\n");

    const activeConsequences = consequences
      .map(c => c.hiddenConsequence)
      .join("\n");

    // Build prompt
    const systemPrompt = GAME_MASTER_SYSTEM_PROMPT
      .replace("{playerName}", game.playerName)
      .replace("{persona}", game.persona)
      .replace("{currentWeek}", String(game.currentWeek))
      .replace("{currentDay}", String(game.currentDay))
      .replace("{money}", String(game.money))
      .replace("{savings}", String(game.savings))
      .replace("{savingsGoal}", String(game.savingsGoal))
      .replace("{creditScore}", String(game.creditScore))
      .replace("{ptptnDebt}", String(game.debt.ptptn))
      .replace("{ccDebt}", String(game.debt.creditCard))
      .replace("{bankDebt}", String(game.debt.bankLoan))
      .replace("{ahLongDebt}", String(game.debt.ahLong))
      .replace("{health}", String(game.health))
      .replace("{stress}", String(game.stress))
      .replace("{familyRel}", String(game.relationships.family))
      .replace("{roommateRel}", String(game.relationships.roommate))
      .replace("{pakAliRel}", String(game.relationships.pakAli))
      .replace("{bossRel}", String(game.relationships.boss))
      .replace("{decisionHistory}", decisionHistory || "No decisions yet.")
      .replace("{activeConsequences}", activeConsequences || "None currently.")
      .replace("{location}", args.locationId);

    const locationContext = LOCATION_SPECIFIC_PROMPTS[args.locationId] || "";

    const response = await anthropic.messages.create({
      model: "claude-sonnet-4-20250514",
      max_tokens: 1500,
      system: systemPrompt,
      messages: [
        {
          role: "user",
          content: `Generate a scenario for this location. Context: ${locationContext}\n\n${
            consequences.length > 0 
              ? "IMPORTANT: A past decision is triggering a consequence this visit!" 
              : ""
          }`,
        },
      ],
    });

    const content = response.content[0];
    if (content.type !== "text") throw new Error("Unexpected response type");

    try {
      return JSON.parse(content.text);
    } catch {
      // If Claude didn't return valid JSON, create a fallback
      return {
        narration: content.text,
        choices: [
          {
            id: "continue",
            text: "Continue",
            innerThought: "Let's see what happens next",
            consequences: { money: 0, credit: 0, health: 0, stress: 0 },
          },
        ],
        emotion: "neutral",
      };
    }
  },
});

export const processChoice = action({
  args: {
    gameId: v.id("games"),
    locationId: v.string(),
    choice: v.any(),
    scenarioTitle: v.string(),
    scenarioText: v.string(),
  },
  handler: async (ctx, args) => {
    const game = await ctx.runQuery(api.games.getById, { gameId: args.gameId });
    if (!game) throw new Error("Game not found");

    const { choice } = args;
    const consequences = choice.consequences || {};

    // Calculate new values
    const newMoney = game.money + (consequences.money || 0);
    const newCredit = Math.max(300, Math.min(850, game.creditScore + (consequences.credit || 0)));
    const newHealth = Math.max(0, Math.min(100, game.health + (consequences.health || 0)));
    const newStress = Math.max(0, Math.min(100, game.stress + (consequences.stress || 0)));

    // Update relationships if applicable
    const newRelationships = { ...game.relationships };
    if (consequences.relationship) {
      const { target, change } = consequences.relationship;
      if (target in newRelationships) {
        newRelationships[target as keyof typeof newRelationships] = Math.max(
          -100,
          Math.min(100, newRelationships[target as keyof typeof newRelationships] + change)
        );
      }
    }

    // Store decision
    await ctx.runMutation(api.decisions.create, {
      gameId: args.gameId,
      week: game.currentWeek,
      day: game.currentDay,
      location: args.locationId,
      scenarioTitle: args.scenarioTitle,
      scenarioText: args.scenarioText,
      choiceMade: choice.id,
      choiceText: choice.text,
      moneyChange: consequences.money || 0,
      creditChange: consequences.credit || 0,
      healthChange: consequences.health || 0,
      stressChange: consequences.stress || 0,
      relationshipChanges: consequences.relationship,
      hiddenConsequence: choice.hiddenConsequence,
      consequenceTriggersWeek: choice.triggersInWeeks 
        ? game.currentWeek + choice.triggersInWeeks 
        : undefined,
      consequenceTriggered: false,
      emotionalTone: "neutral",
      npcInvolved: choice.npcInvolved,
    });

    // Update game state
    await ctx.runMutation(api.games.updateGameState, {
      gameId: args.gameId,
      updates: {
        money: newMoney,
        creditScore: newCredit,
        health: newHealth,
        stress: newStress,
        relationships: newRelationships,
      },
    });

    // Record credit event if credit changed
    if (consequences.credit) {
      await ctx.runMutation(api.creditScore.recordEvent, {
        gameId: args.gameId,
        week: game.currentWeek,
        day: game.currentDay,
        eventType: consequences.credit > 0 ? "positive_action" : "negative_action",
        description: choice.text,
        impact: consequences.credit,
      });
    }

    // Advance time
    const timeResult = await ctx.runMutation(api.games.advanceTime, {
      gameId: args.gameId,
    });

    return {
      newMoney,
      newCredit,
      newHealth,
      newStress,
      newRelationships,
      ...timeResult,
    };
  },
});
```

---

## â° Timeline & Checkpoints

### Hour-by-Hour Plan

| Hour | Pro Dev | Intermediate Dev | Noob |
|------|---------|------------------|------|
| 0-1 | Project setup, Convex init | Next.js + shadcn setup | Read docs, understand game |
| 1-2 | Schema deployment | Tailwind config, layout | Write 3 persona backstories |
| 2-3 | Game creation mutation | GameMap component start | Write location descriptions |
| 3-4 | Get game query | Walking animation | Test Convex in UI |
| 4-5 | Claude integration start | Location markers | Write 10 sample scenarios |
| 5-6 | generateScenario action | LocationDialog component | Test Claude responses |
| 6-7 | processChoice action | Connect dialog to API | Bug testing |
| **7-8** | **SYNC CHECKPOINT** | **First playable test** | **Bug report** |
| 8-9 | Credit score logic | CreditScore component | Start pitch deck |
| 9-10 | Consequence system | StatsBar component | Continue pitch |
| 10-11 | Bill payment logic | Game page integration | Demo script draft |
| 11-12 | Ending generation | Ending page | Record demo video |
| 12-13 | Bug fixes | Polish animations | README |
| 13-14 | Edge cases | Responsive fixes | Submission prep |
| 14-15 | Final testing | Final testing | Practice pitch |
| 15-16 | Deploy + verify | Deploy + verify | Submit |

### Critical Checkpoints

**Hour 4 - Foundation Check:**
- [ ] Convex schema deployed and working
- [ ] Map renders with 7 locations
- [ ] Can create a game and see it in DB

**Hour 8 - Playable Check (CRITICAL):**
- [ ] Player can walk to location
- [ ] Claude generates scenario on arrival
- [ ] Making choice updates game state
- [ ] Credit score displays and changes

**Hour 12 - Feature Complete:**
- [ ] Full week (7 days) playable
- [ ] Past decisions create consequences
- [ ] Bank location works
- [ ] Deployed on Vercel

**Hour 16 - Submission:**
- [ ] Live URL works
- [ ] Demo practiced
- [ ] Submitted before deadline

---

## ğŸ¯ Success Metrics

### Must Achieve
1. Judge can play 2+ minutes without bugs
2. Walking animation works smoothly
3. Claude responses feel intelligent and contextual
4. Credit score visibly changes based on decisions
5. At least one "consequence callback" moment in demo

### Win Conditions by Track

| Track | Win Condition |
|-------|---------------|
| **Anthropic** | Claude remembers past decisions, NPCs have personality |
| **Convex** | Real-time updates, complex relational queries |
| **Ryt Bank** | Credit score education, Ah Long trap demonstration |
| **Mobbin** | Smooth walking, polished dialogs, responsive |
| **Venture** | Clear pitch for schools/AKPK deployment |

---

## ğŸš¨ Emergency Fallbacks

### If walking animation breaks (Hour 6):
```tsx
// Set transition duration to 0 - instant teleport
transition={{ duration: 0 }}
```

### If Claude API fails:
```typescript
// Fallback to pre-written scenarios in constants
const FALLBACK_SCENARIOS = { ... }
```

### If running out of time:
1. Cut to 4 locations instead of 7
2. Cut to 3 days instead of 7
3. Skip ending generation, use static ending
4. Focus on ONE impressive demo flow

---

## ğŸ“ Environment Variables

```bash
# .env.local
CONVEX_DEPLOYMENT=your-deployment-name
ANTHROPIC_API_KEY=sk-ant-xxxxx
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud
```

---

## ğŸš€ Quick Start Commands

```bash
# Install dependencies
pnpm install

# Start Convex dev server (terminal 1)
npx convex dev

# Start Next.js dev server (terminal 2)
pnpm dev

# Deploy to Vercel
vercel --prod
```

---

## ğŸ’¡ Remember

> **The goal is not a perfect game. The goal is a judge feeling something in 2 minutes.**

> "Oh shit, I just got trapped by Ah Long."
> "My credit score dropped and I felt stressed."
> "That consequence from Week 1 came back to haunt me."

**THAT'S the win. Ship it.**
